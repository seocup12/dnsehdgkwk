<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>POKÃ‰ RUN: POKÃ‰MON PROFILE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:ital,wght@0,400;0,700;1,900&family=Inter:wght@400;0,700;0,900&family=Noto+Sans+KR:wght@400;0,700;0,900&display=swap" rel="stylesheet">
    <style>
        /* --- 1. ê¸°ë³¸ í…Œë§ˆ (ë‹¤í¬ ëª¨ë“œ, BLACK) ë³€ìˆ˜ --- */
        :root { 
            --volt: #ccff00; 
            --bg-main: #000000; 
            --bg-card: #111111; 
            --bg-sub: #222222; 
            --text-main: #ffffff; 
            --text-sub: #9ca3af; 
            --border-color: #262626; 
        }
        
        /* âšª 2. í™”ì´íŠ¸ ëª¨ë“œ ë””ìì¸ ë³€ìˆ˜ ì ìš© (WHITE) */
        .white-mode {
            --volt: #2563eb; /* ë¸”ë£¨ */
            --bg-main: #ffffff;
            --bg-card: #f3f4f6;
            --bg-sub: #e5e7eb;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border-color: #d1d5db;
        }

        /* 3. í°íŠ¸ ë° ê³µí†µ ìŠ¤íƒ€ì¼ */
        .font-sport { font-family: 'Chakra Petch', sans-serif; }
        body { 
            background-color: var(--bg-main); 
            color: var(--text-main); 
            font-family: 'Noto Sans KR', sans-serif; 
            transition: background-color 0.3s, color 0.3s;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .spinner { animation: spin 1s linear infinite; }

        /* 4. Tab ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ ì •ì˜ */
        .tab-btn-base {
            flex: 1;
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            display: flex;
            justify-content: center;
            align-items: center; 
            transition: border-color 0.3s, color 0.3s;
            cursor: pointer;
        }
        
        /* â­ï¸ ë„ê° ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #pokedex-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-main);
            z-index: 50;
            transform: translateY(100%);
            transition: transform 0.4s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #pokedex-modal.open {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-[var(--bg-main)] min-h-screen pb-16">
    
    <div id="loading-overlay" class="fixed inset-0 bg-[var(--bg-main)] flex flex-col justify-center items-center z-50 transition-opacity duration-300">
        <i data-lucide="zap" class="w-10 h-10 text-[var(--volt)] spinner"></i>
        <p class="mt-4 text-[var(--text-sub)] text-sm">í¬ì¼“ëª¬ í”„ë¡œí•„ ë¡œë“œ ì¤‘...</p>
    </div>

    <header class="sticky top-0 z-10 p-4 border-b border-[var(--border-color)] bg-[var(--bg-main)] transition-colors">
        <div class="max-w-xl mx-auto flex justify-between items-center">
            <h1 class="font-bold text-xl font-sport flex items-center gap-1">
                <i data-lucide="zap" class="w-6 h-6 text-[var(--volt)]"></i>
                <span class="text-[var(--text-main)]">POKÃ‰</span><span class="text-[var(--volt)]">RUN</span>
            </h1>
            <button onclick="toggleTheme()" class="p-1 rounded-full hover:bg-[var(--bg-sub)] active:scale-95 transition-all text-[var(--text-main)]">
                <i data-lucide="sun-moon" class="w-6 h-6"></i>
            </button>
        </div>
    </header>

    <main class="max-w-xl mx-auto container">
        <div id="profile-content" class="p-4 pt-10 opacity-0 transition-opacity duration-500">
            <div class="flex items-start justify-between mb-5">
                <div class="flex items-center">
                    <img id="my-profile-image" src="https://via.placeholder.com/80x80?text=P" alt="í¬ì¼“ëª¬ ì´ë¯¸ì§€" class="w-20 h-20 rounded-full border-2 border-[var(--volt)] object-cover bg-[var(--bg-sub)]">
                    
                    <div class="ml-4">
                        <h3 id="my-profile-name" class="font-bold text-2xl font-sport text-[var(--volt)]">í¬ì¼“ëª¬ ì´ë¦„</h3>
                        <p id="my-profile-bio" class="text-sm text-[var(--text-sub)] mt-1">ì¢…ì¡± / íƒ€ì…</p>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-3 gap-3 text-center text-sm mb-6 border-y border-[var(--border-color)] py-3">
                <div class="flex flex-col">
                    <span id="pokemon-level" class="text-xl font-bold font-sport text-[var(--volt)]">0</span>
                    <span class="text-xs text-[var(--text-sub)]">LEVEL</span>
                </div>
                <div class="flex flex-col">
                    <span id="hp-stat" class="text-xl font-bold font-sport text-[var(--text-main)]">0</span>
                    <span class="text-xs text-[var(--text-sub)]">HP</span>
                </div>
                <div class="flex flex-col">
                    <span id="attack-stat" class="text-xl font-bold font-sport text-[var(--text-main)]">0</span>
                    <span class="text-xs text-[var(--text-sub)]">ATK</span>
                </div>
            </div>

            <div class="flex gap-2 text-sm font-bold">
                <button onclick="openPokedex()" class="flex-1 bg-[var(--bg-sub)] py-1.5 rounded-lg border border-[var(--border-color)] active:scale-95 transition text-[var(--text-main)] flex items-center justify-center gap-1">
                    <i data-lucide="book-open" class="w-4 h-4"></i>
                    <span>ë‚˜ì˜ ë„ê°</span>
                </button>
                
                <button onclick="loadMyPokemonStatsSummary()" class="flex-1 bg-[var(--bg-sub)] py-1.5 rounded-lg border border-[var(--border-color)] active:scale-95 transition text-[var(--text-main)] flex items-center justify-center gap-1">
                    <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
                    <span>ëŠ¥ë ¥ í™•ì¸</span> 
                </button>
            </div>
            
            <div class="flex border-b border-[var(--border-color)] mt-8 text-sm font-bold">
                <div id="tab-btn-posts" class="tab-btn-base border-b-2 border-[var(--text-main)] text-[var(--text-main)]" onclick="switchTab('posts')">
                    <i data-lucide="sword" class="w-5 h-5"></i><span class="ml-1">ì „ì </span>
                </div>
                <div id="tab-btn-reels" class="tab-btn-base text-[var(--text-sub)]" onclick="switchTab('reels')">
                    <i data-lucide="film" class="w-5 h-5"></i><span class="ml-1">ë¦¬í¬íŠ¸</span>
                </div>
                <div id="tab-btn-tags" class="tab-btn-base text-[var(--text-sub)]" onclick="switchTab('tags')">
                    <i data-lucide="bookmark" class="w-5 h-5"></i><span class="ml-1">íƒœê·¸</span>
                </div>
            </div>

            <div id="tab-content-posts" class="tab-content active pt-6">
                <h4 class="text-lg font-bold font-sport text-[var(--volt)] mb-4 pb-2">ëˆ„ì  ëŒ€ì „ ê¸°ë¡</h4>
                
                <div class="grid grid-cols-3 gap-3 text-center">
                    <div class="bg-[var(--bg-sub)] p-4 rounded-xl shadow-lg">
                        <span id="win-count-total" class="font-bold text-4xl font-sport text-green-400">0</span>
                        <span class="text-xs text-[var(--text-sub)] block mt-1">WIN (ìŠ¹)</span>
                    </div>
                    <div class="bg-[var(--bg-sub)] p-4 rounded-xl shadow-lg">
                        <span id="lose-count-total" class="font-bold text-4xl font-sport text-red-400">0</span>
                        <span class="text-xs text-[var(--text-sub)] block mt-1">LOSE (íŒ¨)</span>
                    </div>
                    <div class="bg-[var(--bg-sub)] p-4 rounded-xl shadow-lg">
                        <span id="draw-count-total" class="font-bold text-4xl font-sport text-yellow-400">0</span>
                        <span class="text-xs text-[var(--text-sub)] block mt-1">DRAW (ë¬´)</span>
                    </div>
                </div>
            </div>

            <div id="tab-content-reels" class="tab-content pt-4">
                <p class="col-span-3 text-center text-[var(--text-sub)] mt-10">ë¦¬í¬íŠ¸ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            <div id="tab-content-tags" class="tab-content pt-4">
                <p class="col-span-3 text-center text-[var(--text-sub)] mt-10">íƒœê·¸ëœ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
    </main>
    
    <nav class="fixed bottom-0 left-0 right-0 max-w-xl mx-auto bg-[var(--bg-main)] border-t border-[var(--border-color)] z-20 transition-colors">
        <div class="flex justify-around items-center h-16">
            <a href="log.html" class="nav-item">
                <i data-lucide="home" class="w-6 h-6 text-[var(--text-sub)]"></i>
            </a>
            <a href="reels.html" class="nav-item">
                <i data-lucide="clapperboard" class="w-6 h-6 text-[var(--text-sub)]"></i>
            </a>
            <a href="#" class="nav-item">
                <i data-lucide="sparkles" class="w-6 h-6 text-[var(--volt)]"></i>
            </a>
            <a href="message.html" class="nav-item">
                <i data-lucide="message-square" class="w-6 h-6 text-[var(--text-sub)]"></i>
            </a>
            <a href="profile.html" class="nav-item">
                <i data-lucide="user" class="w-6 h-6 text-[var(--text-sub)]"></i>
            </a>
        </div>
    </nav>
    
    <div id="pokedex-modal">
        <header class="p-4 border-b border-[var(--border-color)] bg-[var(--bg-main)] flex items-center justify-between">
            <h2 class="font-bold text-xl font-sport text-[var(--volt)]">ë‚˜ì˜ ë„ê°</h2>
            <button onclick="closePokedex()" class="p-2 rounded-full hover:bg-[var(--bg-sub)] active:scale-95 transition">
                <i data-lucide="x" class="w-6 h-6 text-[var(--text-main)]"></i>
            </button>
        </header>
        
        <div class="flex-1 overflow-y-auto p-4 max-w-xl mx-auto w-full">
            <h3 class="text-sm text-[var(--text-sub)] mb-4">ë³´ìœ  ì¤‘ì¸ í¬ì¼“ëª¬ ëª©ë¡ (<span id="pokedex-count">0</span>ë§ˆë¦¬)</h3>
            <div id="pokemon-list" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                <p id="pokedex-loading-message" class="col-span-2 sm:col-span-3 text-center text-[var(--text-sub)] mt-10">í¬ì¼“ëª¬ ë¡œë“œ ì¤‘...</p>
            </div>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    
    <script>
        // ğŸš¨ğŸš¨ğŸš¨ ì‚¬ìš©ìë‹˜ì˜ Firebase í”„ë¡œì íŠ¸ ì„¤ì • ğŸš¨ğŸš¨ğŸš¨
        // ì´ ë¶€ë¶„ì„ ì‚¬ìš©ìë‹˜ì˜ ì •í™•í•œ ê°’ìœ¼ë¡œ êµì²´í–ˆëŠ”ì§€ **ë°˜ë“œì‹œ** ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•´ì£¼ì„¸ìš”.
        const firebaseConfig = {
             apiKey: "AIzaSyAbHwLLXIH8rBQ8gNMVqE5SE208aIbfFZ0",
             authDomain: "pokbattle.firebaseapp.com",
             databaseURL: "https://pokbattle-default-rtdb.firebaseio.com",
             projectId: "pokbattle",
             storageBucket: "pokbattle.firebasestorage.app",
             messagingSenderId: "445300582484",
             appId: "1:445300582484:web:f8f1373a3bbf643face5c1"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        
        let currentPokemonId = null; 

        // í¬ì¼“ëª¬ ë“±ê¸‰ì„ ê²°ì •í•˜ëŠ” í•¨ìˆ˜ (ìŠ¤íƒ¯ ì´í•© ê¸°ì¤€)
        function determineGrade(stats) {
            const total = (stats.hp || 0) + (stats.attack || 0); // HPì™€ ATKë§Œ í•©ì‚°
            let text, color;

            if (total >= 250) { text = 'S+'; color = 'text-red-500'; }
            else if (total >= 230) { text = 'S'; color = 'text-red-400'; }
            else if (total >= 200) { text = 'A'; color = 'text-yellow-500'; }
            else if (total >= 180) { text = 'B'; color = 'text-green-500'; }
            else { text = 'C'; color = 'text-blue-500'; }
            
            return { text, color, total };
        }

        // UI ì—…ë°ì´íŠ¸ë¥¼ í†µí•©í•˜ëŠ” í—¬í¼ í•¨ìˆ˜ (í”„ë¡œí•„)
        function updateUI(data) {
            document.getElementById('my-profile-image').src = data.photoURL || (data.pokeId ? `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${data.pokeId}.png` : 'https://via.placeholder.com/80x80?text=P');
            document.getElementById('my-profile-name').innerText = data.nickname || data.species || "ì´ë¦„ ì—†ìŒ";
            document.getElementById('my-profile-bio').innerText = `${data.species || 'Unknown'} í¬ì¼“ëª¬ | íƒ€ì…: ${data.type || 'Normal'}`;

            document.getElementById('pokemon-level').innerText = data.level || 1;
            document.getElementById('hp-stat').innerText = data.stats.hp || 0;
            document.getElementById('attack-stat').innerText = data.stats.attack || 0;
            
            // ì „ì  íƒ­ì— ë°ì´í„° ì—…ë°ì´íŠ¸
            document.getElementById('win-count-total').innerText = data.battle.wins || 0;
            document.getElementById('lose-count-total').innerText = data.battle.loses || 0;
            document.getElementById('draw-count-total').innerText = data.battle.draws || 0;
        }

        // ===============================================
        // 1. í•µì‹¬ ê¸°ëŠ¥: í¬ì¼“ëª¬ í”„ë¡œí•„ ë°ì´í„° ë¡œë“œ (ì˜¤ë¥˜ ë³´ê³  ê°•í™” ë²„ì „)
        // ===============================================
        window.loadPokemonProfile = async (pokemonId) => {
            const profileContent = document.getElementById('profile-content');
            const loadingOverlay = document.getElementById('loading-overlay');
            const myProfileName = document.getElementById('my-profile-name');
            const myProfileBio = document.getElementById('my-profile-bio');
            
            loadingOverlay.classList.remove('opacity-0', 'hidden'); 
            profileContent.classList.remove('opacity-100'); 

            if (!pokemonId || pokemonId === 'dummy_test') {
                // ë”ë¯¸ ë°ì´í„° ë¡œë“œ (ID ëˆ„ë½ ì‹œ ë˜ëŠ” í…ŒìŠ¤íŠ¸ìš©)
                const dummyData = {
                    nickname: "âš¡ï¸ í”¼ì¹´ì¸„ (í…ŒìŠ¤íŠ¸)",
                    species: "ì „ê¸°ì¥ í¬ì¼“ëª¬",
                    type: "ì „ê¸°",
                    pokeId: 25, 
                    level: 99,
                    stats: { hp: 120, attack: 150 },
                    battle: { wins: 30, loses: 10, draws: 5 }, 
                    photoURL: null 
                };
                updateUI(dummyData);
                currentPokemonId = 'dummy_test'; 
            } else {
                // â­ï¸ ì‹¤ì œ Firebase ë°ì´í„° ë¡œë“œ (ë‹¨ì¼ í”„ë¡œí•„) â­ï¸
                try {
                    const snap = await db.ref(`pokemon_profiles/${pokemonId}`).once('value');
                    
                    if (snap.exists()) {
                        updateUI(snap.val());
                    } else {
                        myProfileName.innerText = "âš ï¸ ë°ì´í„° ì—†ìŒ";
                        myProfileBio.innerText = `ID: ${pokemonId} ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`;
                    }
                    currentPokemonId = pokemonId; 

                } catch (error) {
                    console.error("ğŸ”¥ í¬ì¼“ëª¬ í”„ë¡œí•„ ë¡œë“œ ì‹¤íŒ¨:", error);
                    myProfileName.innerText = "âŒ ë¡œë“œ ì˜¤ë¥˜";
                    myProfileBio.innerText = `Firebase ì—°ê²° ì˜¤ë¥˜: ${error.code || 'UNKNOWN'}`;
                    alert(`Firebase í”„ë¡œí•„ ë¡œë“œ ì˜¤ë¥˜ ë°œìƒ: ${error.code || 'UNKNOWN'}\n\në°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:\n1. Firebase Config ê°’\n2. Database Rules í™•ì¸`);
                }
            }
            
            // ë¡œë”© ì¢…ë£Œ
            loadingOverlay.classList.add('opacity-0');
            setTimeout(() => loadingOverlay.classList.add('hidden'), 300);
            profileContent.classList.add('opacity-100');
            lucide.createIcons();
        };


        // ===============================================
        // 2. ì‹ ê·œ ê¸°ëŠ¥: ë„ê° ì—°ë™ ë° ëŠ¥ë ¥ì¹˜ ì„¤ëª… (ì˜¤ë¥˜ ë³´ê³  ê°•í™” ë²„ì „)
        // ===============================================

        // í¬ì¼“ëª¬ ì¹´ë“œ ìƒì„± í…œí”Œë¦¿
        function createPokemonCard(id, data) {
            const stats = data.stats || {};
            const grade = determineGrade(stats);
            const spriteUrl = data.pokeId ? `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${data.pokeId}.png` : 'https://via.placeholder.com/80x80?text=P';
            
            const movesList = (data.moves || []).slice(0, 3).map(move => `<span class="text-xs text-[var(--text-sub)] bg-[var(--bg-sub)] px-1.5 py-0.5 rounded-full">${move}</span>`).join('');

            return `
                <div onclick="selectPokemon('${id}')" 
                     class="bg-[var(--bg-card)] p-3 rounded-xl border border-[var(--border-color)] shadow-xl hover:shadow-[0_0_15px_0_rgba(204,255,0,0.2)] transition duration-200 cursor-pointer">
                    <div class="text-right mb-2">
                        <span class="font-bold text-lg font-sport ${grade.color}">${grade.text}</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <img src="${spriteUrl}" alt="${data.species}" class="w-24 h-24 object-contain mb-2">
                        <h4 class="font-bold text-base text-[var(--text-main)]">${data.nickname || data.species}</h4>
                        <p class="text-xs text-[var(--text-sub)] mb-3">Lv.${data.level || 1}</p>
                        <div class="flex gap-3 text-sm mb-3">
                            <div><i data-lucide="heart" class="w-3 h-3 inline-block text-red-400 mr-1"></i>HP: <span class="font-bold">${stats.hp || 0}</span></div>
                            <div><i data-lucide="swords" class="w-3 h-3 inline-block text-orange-400 mr-1"></i>ATK: <span class="font-bold">${stats.attack || 0}</span></div>
                        </div>
                        <div class="flex flex-wrap justify-center gap-1.5 min-h-[30px] w-full mt-1">
                            ${movesList || '<span class="text-xs text-[var(--text-sub)]">ë“±ë¡ëœ ê¸°ìˆ  ì—†ìŒ</span>'}
                        </div>
                    </div>
                </div>
            `;
        }

        // [ë„ê° ì—°ë™ ê¸°ëŠ¥] ë„ê°ì—ì„œ í¬ì¼“ëª¬ì„ ì„ íƒí•˜ì—¬ ë©”ì¸ í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ë° ì—°ê²°
        window.selectPokemon = (pokemonId) => {
            if (!pokemonId) return;
            document.body.classList.remove('white-mode');
            localStorage.setItem('theme', 'dark');
            
            currentPokemonId = pokemonId; 
            loadPokemonProfile(pokemonId);
            closePokedex();
            
            const newUrl = `${window.location.pathname}?id=${pokemonId}`;
            window.history.pushState({ path: newUrl }, '', newUrl);
            
            document.getElementById('profile-content').scrollIntoView({ behavior: 'smooth' });
            lucide.createIcons();
        };


        // [ë³´ìœ  í¬ì¼“ëª¬ ëŠ¥ë ¥ì¹˜ ì„¤ëª… ê¸°ëŠ¥]
        window.loadMyPokemonStatsSummary = async () => {
            try {
                const snapshot = await db.ref('pokemon_profiles').once('value');
                const pokemonData = snapshot.val();
                let summary = "===================================\n";
                summary += "           â­ï¸ ë³´ìœ  í¬ì¼“ëª¬ ëŠ¥ë ¥ì¹˜ ìš”ì•½ â­ï¸\n";
                summary += "===================================\n";
                let count = 0;

                if (pokemonData) {
                    Object.entries(pokemonData).forEach(([id, data]) => {
                        const stats = data.stats || {};
                        const grade = determineGrade(stats);
                        
                        summary += `\n[${data.nickname || data.species}]\n`;
                        summary += `  - ë“±ê¸‰: ${grade.text} (ì´í•©: ${grade.total})\n`;
                        summary += `  - HP: ${stats.hp || 0}, ATK: ${stats.attack || 0}\n`;
                        count++;
                    });
                }
                
                if (count === 0) {
                    summary += "\në³´ìœ í•œ í¬ì¼“ëª¬ì´ ì—†ìŠµë‹ˆë‹¤. ë„ê°ì„ ì±„ì›Œì£¼ì„¸ìš”!";
                } else {
                    summary += `\n===================================\nì´ ${count}ë§ˆë¦¬ ë³´ìœ  ì¤‘ì…ë‹ˆë‹¤.`;
                }

                alert(summary); 
                
            } catch (error) {
                console.error("ğŸ”¥ ëŠ¥ë ¥ì¹˜ ìš”ì•½ ë¡œë“œ ì‹¤íŒ¨:", error);
                alert(`ëŠ¥ë ¥ì¹˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.code || 'UNKNOWN'}\n\n[1ë‹¨ê³„] Firebase Config ê°’ í™•ì¸\n[2ë‹¨ê³„] Database Rules í™•ì¸`);
            }
        };


        // [ë‚˜ì˜ ë„ê° ëª©ë¡ ë¡œë“œ] ë„ê° ëª¨ë‹¬ì— ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ë¡œë“œ (ì˜¤ë¥˜ ë³´ê³  ê°•í™” ë²„ì „)
        window.loadMyPokemonList = async () => {
            const listContainer = document.getElementById('pokemon-list');
            const loadingMessage = document.getElementById('pokedex-loading-message');
            const countElement = document.getElementById('pokedex-count');
            
            listContainer.innerHTML = ''; 
            loadingMessage.style.display = 'block';
            loadingMessage.innerHTML = 'í¬ì¼“ëª¬ ë¡œë“œ ì¤‘...'; 

            try {
                // â­ï¸ pokemon_profiles ì „ì²´ ë°ì´í„° ë¡œë“œ â­ï¸
                const snapshot = await db.ref('pokemon_profiles').once('value');
                const pokemonData = snapshot.val();
                let cardHtml = '';
                let count = 0;

                if (pokemonData) {
                    Object.entries(pokemonData).forEach(([id, data]) => {
                        cardHtml += createPokemonCard(id, data);
                        count++;
                    });
                }
                
                loadingMessage.style.display = 'none';
                
                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ 'ë°ì´í„° ì—†ìŒ' ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
                listContainer.innerHTML = cardHtml || '<p class="col-span-2 sm:col-span-3 text-center text-[var(--text-sub)] mt-10">ë³´ìœ í•œ í¬ì¼“ëª¬ì´ ì—†ìŠµë‹ˆë‹¤. (Firebase Realtime Databaseì˜ **pokemon_profiles** ê²½ë¡œì— ë°ì´í„°ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.)</p>';
                
                countElement.innerText = count;
                lucide.createIcons();
                console.log("âœ… Firebase ë¡œë“œ ì„±ê³µ: ë°ì´í„° ìˆ˜:", count);
                
            } catch (error) {
                // âŒ ì˜¤ë¥˜ ë°œìƒ ì‹œ ìƒì„¸ ë³´ê³  (ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„!)
                console.error("ğŸ”¥ ë„ê° ë¡œë“œ ì‹¤íŒ¨ (Firebase Error):", error.message);
                
                const errorMessage = `ğŸ”¥ Firebase ì˜¤ë¥˜ ë°œìƒ: ${error.code || 'UNKNOWN'}\n\në°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:\n1. Firebase Config ê°’ í™•ì¸\n2. Realtime Databaseì˜ ê·œì¹™ ì„¤ì • (PERMISSION_DENIED ê°€ëŠ¥ì„± ë†’ìŒ)`;
                
                loadingMessage.style.display = 'block';
                loadingMessage.innerHTML = `<span class="text-red-400 font-bold">${errorMessage.replace(/\n/g, '<br>')}</span>`;
                listContainer.innerHTML = '';
                countElement.innerText = '0';
                alert(errorMessage); 
            }
        };


        // 'ë‚˜ì˜ ë„ê°' ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸° ë° ëª©ë¡ ë¡œë“œ
        window.openPokedex = () => {
            document.getElementById('pokedex-modal').classList.add('open');
            document.body.style.overflow = 'hidden'; 
            loadMyPokemonList();
        };

        // ë„ê° ë‹«ê¸°
        window.closePokedex = () => {
            document.getElementById('pokedex-modal').classList.remove('open');
            document.body.style.overflow = '';
        };
        
        // ===============================================
        // 3. UI ê³µí†µ ê¸°ëŠ¥ (í…Œë§ˆ, íƒ­)
        // ===============================================
        
        window.loadTheme = () => {
            if (localStorage.getItem('theme') === 'white') {
                document.body.classList.add('white-mode');
            }
        };

        window.toggleTheme = () => {
            document.body.classList.toggle('white-mode');
            localStorage.setItem('theme', document.body.classList.contains('white-mode') ? 'white' : 'dark');
            lucide.createIcons(); 
        };

        window.switchTab = (tabName) => {
            const tabs = ['posts', 'reels', 'tags'];
            const tabBaseClass = "tab-btn-base";
            const tabActiveClass = "border-b-2 border-[var(--text-main)] text-[var(--text-main)]";
            const tabInactiveClass = "text-[var(--text-sub)]";

            tabs.forEach(t => {
                const content = document.getElementById(`tab-content-${t}`);
                const btn = document.getElementById(`tab-btn-${t}`);

                content.classList.remove('active');
                
                btn.className = tabBaseClass;

                if (t === tabName) {
                    content.classList.add('active');
                    btn.classList.add(...tabActiveClass.split(' '));
                } else {
                    btn.classList.add(...tabInactiveClass.split(' '));
                }
            });
            lucide.createIcons(); 
        };

        // í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰
        window.onload = () => {
            loadTheme();
            const urlParams = new URLSearchParams(window.location.search);
            currentPokemonId = urlParams.get('id'); 

            // IDê°€ ì—†ìœ¼ë©´ 'dummy_test'ë¡œ ë¡œë“œ (í…ŒìŠ¤íŠ¸ìš©)
            loadPokemonProfile(currentPokemonId || 'dummy_test'); 
            switchTab('posts'); // 'ì „ì ' íƒ­ ê¸°ë³¸ í™œì„±í™”
        };
    </script>
</body>
</html>