<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>POKÃ‰ RUN: POKÃ‰MON PROFILE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:ital,wght@0,400;0,700;1,900&family=Inter:wght@400;0,700;0,900&family=Noto+Sans+KR:wght@400;0,700;0,900&display=swap" rel="stylesheet">
    <style>
        /* --- 1. ê¸°ë³¸ í…Œë§ˆ (ë‹¤í¬ ëª¨ë“œ, BLACK) ë³€ìˆ˜ --- */
        :root { 
            --volt: #ccff00; 
            --bg-main: #000000; 
            --bg-card: #111111; 
            --bg-sub: #222222; 
            --text-main: #ffffff; 
            --text-sub: #9ca3af; 
            --border-color: #262626; 
        }
        
        /* âšª 2. í™”ì´íŠ¸ ëª¨ë“œ ë””ìì¸ ë³€ìˆ˜ ì ìš© (WHITE) */
        .white-mode {
            --volt: #2563eb; /* ë¸”ë£¨ */
            --bg-main: #ffffff;
            --bg-card: #f3f4f6;
            --bg-sub: #e5e7eb;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border-color: #d1d5db;
        }

        /* 3. í°íŠ¸ ë° ê³µí†µ ìŠ¤íƒ€ì¼ */
        .font-sport { font-family: 'Chakra Petch', sans-serif; }
        body { 
            background-color: var(--bg-main); 
            color: var(--text-main); 
            font-family: 'Noto Sans KR', sans-serif; 
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .spinner { animation: spin 1s linear infinite; }

    </style>
</head>
<body class="bg-[var(--bg-main)] min-h-screen"> <div id="loading-overlay" class="fixed inset-0 bg-[var(--bg-main)] flex flex-col justify-center items-center z-50 transition-opacity duration-300">
        <i data-lucide="zap" class="w-10 h-10 text-[var(--volt)] spinner"></i>
        <p class="mt-4 text-[var(--text-sub)] text-sm">í¬ì¼“ëª¬ í”„ë¡œí•„ ë¡œë“œ ì¤‘...</p>
    </div>

    <header class="sticky top-0 z-10 p-4 border-b border-[var(--border-color)] bg-[var(--bg-main)] transition-colors">
        <div class="max-w-xl mx-auto flex justify-between items-center">
            <h1 class="font-bold text-xl font-sport flex items-center gap-1">
                <i data-lucide="zap" class="w-6 h-6 text-[var(--volt)]"></i>
                <span class="text-[var(--text-main)]">POKÃ‰</span><span class="text-[var(--volt)]">RUN</span>
            </h1>
            <button onclick="toggleTheme()" class="p-1 rounded-full hover:bg-[var(--bg-sub)] active:scale-95 transition-all text-[var(--text-main)]">
                <i data-lucide="sun-moon" class="w-6 h-6"></i>
            </button>
        </div>
    </header>

    <main class="max-w-xl mx-auto container">
        <div id="profile-content" class="p-4 pt-10 opacity-0 transition-opacity duration-500">
            <div class="flex items-start justify-between mb-5">
                <div class="flex items-center">
                    <img id="my-profile-image" src="https://via.placeholder.com/80x80?text=P" alt="í¬ì¼“ëª¬ ì´ë¯¸ì§€" class="w-20 h-20 rounded-full border-2 border-[var(--volt)] object-cover bg-[var(--bg-sub)]">
                    
                    <div class="ml-4">
                        <h3 id="my-profile-name" class="font-bold text-2xl font-sport text-[var(--volt)]">í¬ì¼“ëª¬ ì´ë¦„</h3>
                        <p id="my-profile-bio" class="text-sm text-[var(--text-sub)] mt-1">ì¢…ì¡± / íƒ€ì…</p>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-3 gap-3 text-center text-sm mb-6 border-y border-[var(--border-color)] py-3">
                <div class="flex flex-col">
                    <span id="pokemon-level" class="text-xl font-bold font-sport text-[var(--volt)]">0</span>
                    <span class="text-xs text-[var(--text-sub)]">LEVEL</span>
                </div>
                <div class="flex flex-col">
                    <span id="hp-stat" class="text-xl font-bold font-sport text-[var(--text-main)]">0</span>
                    <span class="text-xs text-[var(--text-sub)]">HP</span>
                </div>
                <div class="flex flex-col">
                    <span id="attack-stat" class="text-xl font-bold font-sport text-[var(--text-main)]">0</span>
                    <span class="text-xs text-[var(--text-sub)]">ATK</span>
                </div>
            </div>

            <div id="battle-records" class="pt-6"> 
                <h4 class="text-lg font-bold font-sport text-[var(--volt)] mb-4 pb-2 border-b border-[var(--border-color)]">ëˆ„ì  ëŒ€ì „ ê¸°ë¡</h4> 
                
                <div class="grid grid-cols-3 gap-3 text-center">
                    <div class="bg-[var(--bg-sub)] p-4 rounded-xl shadow-lg">
                        <span id="win-count-total" class="font-bold text-4xl font-sport text-green-400">0</span>
                        <span class="text-xs text-[var(--text-sub)] block mt-1">WIN (ìŠ¹)</span>
                    </div>
                    <div class="bg-[var(--bg-sub)] p-4 rounded-xl shadow-lg">
                        <span id="lose-count-total" class="font-bold text-4xl font-sport text-red-400">0</span>
                        <span class="text-xs text-[var(--text-sub)] block mt-1">LOSE (íŒ¨)</span>
                    </div>
                    <div class="bg-[var(--bg-sub)] p-4 rounded-xl shadow-lg">
                        <span id="draw-count-total" class="font-bold text-4xl font-sport text-yellow-400">0</span>
                        <span class="text-xs text-[var(--text-sub)] block mt-1">DRAW (ë¬´)</span>
                    </div>
                </div>
            </div>

        </div>
    </main>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    
    <script>
        // ğŸš¨ğŸš¨ğŸš¨ ì‚¬ìš©ìë‹˜ì˜ Firebase í”„ë¡œì íŠ¸ ì„¤ì • ğŸš¨ğŸš¨ğŸš¨
        // ì´ ë¶€ë¶„ì„ ì‚¬ìš©ìë‹˜ì˜ ì •í™•í•œ ê°’ìœ¼ë¡œ êµì²´í–ˆëŠ”ì§€ **ë°˜ë“œì‹œ** ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•´ì£¼ì„¸ìš”.
        const firebaseConfig = {
             apiKey: "AIzaSyAbHwLLXIH8rBQ8gNMVqE5SE208aIbfFZ0",
             authDomain: "pokbattle.firebaseapp.com",
             databaseURL: "https://pokbattle-default-rtdb.firebaseio.com",
             projectId: "pokbattle",
             storageBucket: "pokbattle.firebasestorage.app",
             messagingSenderId: "445300582484",
             appId: "1:445300582484:web:f8f1373a3bbf643face5c1"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        
        let currentPokemonId = null; 

        // UI ì—…ë°ì´íŠ¸ë¥¼ í†µí•©í•˜ëŠ” í—¬í¼ í•¨ìˆ˜ (í”„ë¡œí•„)
        function updateUI(data) {
            document.getElementById('my-profile-image').src = data.photoURL || (data.pokeId ? `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${data.pokeId}.png` : 'https://via.placeholder.com/80x80?text=P');
            document.getElementById('my-profile-name').innerText = data.nickname || data.species || "ì´ë¦„ ì—†ìŒ";
            document.getElementById('my-profile-bio').innerText = `${data.species || 'Unknown'} í¬ì¼“ëª¬ | íƒ€ì…: ${data.type || 'Normal'}`;

            document.getElementById('pokemon-level').innerText = data.level || 1;
            document.getElementById('hp-stat').innerText = data.stats.hp || 0;
            document.getElementById('attack-stat').innerText = data.stats.attack || 0;
            
            // ì „ì  íƒ­ì— ë°ì´í„° ì—…ë°ì´íŠ¸
            document.getElementById('win-count-total').innerText = data.battle.wins || 0;
            document.getElementById('lose-count-total').innerText = data.battle.loses || 0;
            document.getElementById('draw-count-total').innerText = data.battle.draws || 0;
        }

        // ===============================================
        // 1. í•µì‹¬ ê¸°ëŠ¥: í¬ì¼“ëª¬ í”„ë¡œí•„ ë°ì´í„° ë¡œë“œ
        // ===============================================
        window.loadPokemonProfile = async (pokemonId) => {
            const profileContent = document.getElementById('profile-content');
            const loadingOverlay = document.getElementById('loading-overlay');
            const myProfileName = document.getElementById('my-profile-name');
            const myProfileBio = document.getElementById('my-profile-bio');
            
            loadingOverlay.classList.remove('opacity-0', 'hidden'); 
            profileContent.classList.remove('opacity-100'); 

            if (!pokemonId || pokemonId === 'dummy_test') {
                // ë”ë¯¸ ë°ì´í„° ë¡œë“œ (ID ëˆ„ë½ ì‹œ ë˜ëŠ” í…ŒìŠ¤íŠ¸ìš©)
                const dummyData = {
                    nickname: "âš¡ï¸ í”¼ì¹´ì¸„ (í…ŒìŠ¤íŠ¸)",
                    species: "ì „ê¸°ì¥ í¬ì¼“ëª¬",
                    type: "ì „ê¸°",
                    pokeId: 25, 
                    level: 99,
                    stats: { hp: 120, attack: 150 },
                    battle: { wins: 30, loses: 10, draws: 5 }, 
                    photoURL: null 
                };
                updateUI(dummyData);
                currentPokemonId = 'dummy_test'; 
            } else {
                // â­ï¸ ì‹¤ì œ Firebase ë°ì´í„° ë¡œë“œ (ë‹¨ì¼ í”„ë¡œí•„) â­ï¸
                try {
                    const snap = await db.ref(`pokemon_profiles/${pokemonId}`).once('value');
                    
                    if (snap.exists()) {
                        updateUI(snap.val());
                    } else {
                        myProfileName.innerText = "âš ï¸ ë°ì´í„° ì—†ìŒ";
                        myProfileBio.innerText = `ID: ${pokemonId} ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`;
                    }
                    currentPokemonId = pokemonId; 

                } catch (error) {
                    console.error("ğŸ”¥ í¬ì¼“ëª¬ í”„ë¡œí•„ ë¡œë“œ ì‹¤íŒ¨:", error);
                    myProfileName.innerText = "âŒ ë¡œë“œ ì˜¤ë¥˜";
                    myProfileBio.innerText = `Firebase ì—°ê²° ì˜¤ë¥˜: ${error.code || 'UNKNOWN'}`;
                    alert(`Firebase í”„ë¡œí•„ ë¡œë“œ ì˜¤ë¥˜ ë°œìƒ: ${error.code || 'UNKNOWN'}\n\në°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:\n1. Firebase Config ê°’\n2. Database Rules í™•ì¸`);
                }
            }
            
            // ë¡œë”© ì¢…ë£Œ
            loadingOverlay.classList.add('opacity-0');
            setTimeout(() => loadingOverlay.classList.add('hidden'), 300);
            profileContent.classList.add('opacity-100');
            lucide.createIcons();
        };

        // ===============================================
        // 2. UI ê³µí†µ ê¸°ëŠ¥ (í…Œë§ˆ)
        // ===============================================
        
        window.loadTheme = () => {
            if (localStorage.getItem('theme') === 'white') {
                document.body.classList.add('white-mode');
            }
        };

        window.toggleTheme = () => {
            document.body.classList.toggle('white-mode');
            localStorage.setItem('theme', document.body.classList.contains('white-mode') ? 'white' : 'dark');
            lucide.createIcons(); 
        };

        // í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰
        window.onload = () => {
            loadTheme();
            const urlParams = new URLSearchParams(window.location.search);
            currentPokemonId = urlParams.get('id'); 

            // IDê°€ ì—†ìœ¼ë©´ 'dummy_test'ë¡œ ë¡œë“œ (í…ŒìŠ¤íŠ¸ìš©)
            loadPokemonProfile(currentPokemonId || 'dummy_test'); 
        };
    </script>
</body>
</html>